<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="note">
<meta property="og:type" content="article">
<meta property="og:title" content="精通Spring4.x-chapter5">
<meta property="og:url" content="http://example.com/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter5/index.html">
<meta property="og:site_name" content="A box of chocolates">
<meta property="og:description" content="note">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210426193657.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210426200627.png">
<meta property="og:image" content="http://example.com/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter5/20210426201909.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428152137.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428154444.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428155610.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428162024.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428163623.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428163557.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428163804.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428163824.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428164001.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428164522.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428190934.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428191246.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428193204.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428200634.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428201518.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428202245.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428203131.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428205325.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428205344.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428205429.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428205635.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428205933.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428210114.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428210327.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428210615.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210428211500.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210506190256.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210506190533.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210506191920.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210506192927.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210506200013.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507182128.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507182818.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507183302.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507183639.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507183721.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507184039.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507184513.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507190527.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507191429.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507192052.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210507194502.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210508190707.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210508195338.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210512145645.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210508200206.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210512153137.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210512163230.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210512194247.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210512194313.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210512194325.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210513202132.png">
<meta property="og:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210513202333.png">
<meta property="article:published_time" content="2021-05-08T11:20:19.000Z">
<meta property="article:modified_time" content="2021-05-14T10:03:07.891Z">
<meta property="article:author" content="McLaren888">
<meta property="article:tag" content="spring4.x">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/mclaren8/images/master/20210426193657.png">


<link rel="canonical" href="http://example.com/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter5/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;http:&#x2F;&#x2F;example.com&#x2F;2021&#x2F;05&#x2F;08&#x2F;%E7%B2%BE%E9%80%9ASpring4-x-chapter5&#x2F;&quot;,&quot;path&quot;:&quot;2021&#x2F;05&#x2F;08&#x2F;精通Spring4-x-chapter5&#x2F;&quot;,&quot;title&quot;:&quot;精通Spring4.x-chapter5&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>精通Spring4.x-chapter5 | A box of chocolates</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">A box of chocolates</h1>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/uploads/custom-logo.jpg" alt="A box of chocolates">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8Dbean"><span class="nav-number">1.</span> <span class="nav-text">自动装配Bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#autowired%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5"><span class="nav-number">1.1.</span> <span class="nav-text">Autowired进行自动注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8autowired%E7%9A%84required%E5%B1%9E%E6%80%A7"><span class="nav-number">1.2.</span> <span class="nav-text">使用@Autowired的required属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8qualifier%E6%8C%87%E5%AE%9A%E6%B3%A8%E5%85%A5bean%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="nav-number">1.3.</span> <span class="nav-text">使用@Qualifier指定注入Bean的名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E7%B1%BB%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E6%A0%87%E6%B3%A8"><span class="nav-number">1.4.</span> <span class="nav-text">对类方法进行标注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E9%9B%86%E5%90%88%E7%B1%BB%E8%BF%9B%E8%A1%8C%E6%A0%87%E6%B3%A8"><span class="nav-number">1.5.</span> <span class="nav-text">对集合类进行标注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E5%BB%B6%E8%BF%9F%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-number">1.6.</span> <span class="nav-text">对延迟依赖注入的支持</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bean%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4%E5%8F%8A%E7%94%9F%E5%91%BD%E8%BF%87%E7%A8%8B%E6%96%B9%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">Bean作用范围及生命过程方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Ejava%E7%B1%BB%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number"></span> <span class="nav-text">基于Java类的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#javaconfig"><span class="nav-number">1.</span> <span class="nav-text">JavaConfig</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">启动容器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8configuration%E5%90%AF%E5%8A%A8"><span class="nav-number">2.1.</span> <span class="nav-text">使用@Configuration启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87xml%E5%BC%95%E7%94%A8configuration"><span class="nav-number">2.2.</span> <span class="nav-text">通过XML引用@Configuration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87configuration%E9%85%8D%E7%BD%AE%E7%B1%BB%E5%BC%95%E7%94%A8xml"><span class="nav-number">2.3.</span> <span class="nav-text">通过@Configuration配置类引用XML</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Egroovy-dsl%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">基于Groovy DSL的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8-1"><span class="nav-number">3.1.</span> <span class="nav-text">启动容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDbean"><span class="nav-number">4.</span> <span class="nav-text">通过编码方式动态加载Bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87defaultlistablebeanfactory"><span class="nav-number">4.1.</span> <span class="nav-text">通过DefaultListableBeanFactory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE"><span class="nav-number">4.2.</span> <span class="nav-text">扩展自定义标签</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%E6%AF%94%E8%BE%83"><span class="nav-number">5.</span> <span class="nav-text">不同配置方式比较</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">McLaren888</p>
  <div class="site-description" itemprop="description">It takes a strong man to save himself,and a great man to save another.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kai-soul" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kai-soul" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="McLaren888">
      <meta itemprop="description" content="It takes a strong man to save himself,and a great man to save another.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A box of chocolates">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          精通Spring4.x-chapter5
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-08 19:20:19" itemprop="dateCreated datePublished" datetime="2021-05-08T19:20:19+08:00">2021-05-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-14 18:03:07" itemprop="dateModified" datetime="2021-05-14T18:03:07+08:00">2021-05-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">note</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>Spring容器高层视图</strong></p>
<p>Spring容器启动需要三个条件：</p>
<p>Sprng框架的类包放在应用程序的类路径下；</p>
<p>应用程序为Spring提供了完备的Bean配置信息；</p>
<p>Bean的类已经放在应用程序的类路径下</p>
<p>Spring启动时读取应用程序提供的Bean配置信息，并在Spring容器中生成一份相应的Bean配置注册表，根据这张表实例化Bean，装配好Bean之间的关系，最后把这些准备就绪的Bean放到Bean缓存池中，以供外层的应用程序进行调用</p>
<p>Bean配置信息：</p>
<p>Bean的实现类；</p>
<p>Bean的属性信息，如数据源的连接数、用户名、密码等</p>
<p>Bean的依赖关系，Spring根据依赖关系完成Bean之间的装配</p>
<p>Bean的行为配置，如生命周期范围及生命周期各过程的回调函数等</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210426193657.png" /></p>
<p><strong>基于XML的配置</strong></p>
<p>采用Schema格式</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210426200627.png" /></p>
<p>命名空间的定义分为两个步骤：</p>
<p>第一步指定命名空间的名称；</p>
<p>第二步指定命名空间的Schema文档格式文件的位置，用空格或回车换行进行分隔</p>
<p>在第一步中，要指定命名空间的缩略名和全名，例如图中的③处</p>
<p>aop为别名，文档后面的元素可通过别名加以区别，例如<a href="aop:config/" class="uri">aop:config/</a>等；而引号内的网址为空间的全限定名，习惯上用文档发布机构的官网作为全限定名，可以很好表示文档所属机构，也可以避免重名。但就语法上说，别名和限定名可任意命名</p>
<p>若别名为空，则表示该命名空间为文档默认命名空间。文档中无前缀的元素都属于默认命名空间，例如<beans/>属于①处定义的默认命名空间</p>
<p>在第二步中，定义的语法如下：</p>
<img src="/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter5/20210426201909.png" class="">
<p>命名空间使用全限定名，一般使用组织机构提供引用的URL地址，例如④处</p>
<p><strong>Bean基本配置</strong></p>
<p>Bean的定义：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428152137.png" /></p>
<p>Bean的命名：</p>
<p>配置一个Bean时，需要指定一个<strong>唯一</strong>的id属性作为Bean的名称，并且需要满足规范：必须以字母开始，不允许逗号、空格这些非完整结束符，如果需要使用特殊符号进行命名，则可以使用<bean>的name属性。</p>
<p>name和id都可以指定多个名字，以逗号、分号或空格进行分隔</p>
<p>id可以不同而name可以相同，使用getBean方法时，传入参数若为name，则返回后面声明的Bean（覆盖了前面的name），因此尽量使用id命名</p>
<p>若未指定id和name属性，则Spring自动将全限定类名作为Bean的名称。</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428154444.png" /></p>
<p><strong>属性注入</strong></p>
<p>通过setXxx()方法注入Bean的属性值或依赖对象。</p>
<p>Spring先调用Bean的默认构造函数实例化Bean对象，然后通过反射的方式调用Setter方法注入属性值。</p>
<p>在配置文件中进行属性注入</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428155610.png" /></p>
<p>该Bean有三个属性值，每个属性值对应一个<property>标签，name为属性名称，maxSpeed对应setMaxSpeed()方法</p>
<p>Java中xxx属性对应setXxx()方法，属性变量名必须满足：<strong>“变量的前两个字母要么全部大写，要么全部小写”</strong></p>
<p><strong>构造函数注入</strong></p>
<p>①按类型匹配入参</p>
<p>Bean提供带参的构造函数，在Spring配置文件使用<construcotr-arg>中的type属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String brand, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">this</span>.brand=brand;</span><br><span class="line">				<span class="keyword">this</span>.price=price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428162024.png" /></p>
<p><constructor-arg>的位置不会影响配置效果，不一定要按照参数顺序</p>
<p>②按索引匹配入参</p>
<p>java通过入参的类型及顺序区分不同的重载方法。</p>
<p>若构造函数有两个类型相同的入参，那么方法①就无法确定了。</p>
<p>原因（Spring按JavaBean规范找对配置属性所对应的Setter方法，并使用Java反射机制调用Setter方法完成属性注入，但反射机制不会记住构造函数的参数名，因此只能通过入参类型确定配置项与入参的对应关系）</p>
<p>示例</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428163623.png" /></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428163557.png" /></p>
<p>第一个参数索引为0，依此类推</p>
<p>③联合类型和索引匹配入参</p>
<p>示例</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428163804.png" /></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428163824.png" /></p>
<p>④通过自身类型反射匹配入参</p>
<p>构造函数的入参的类型是可辨别的（非基础数据类型且入参类型各异）</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428164001.png" /></p>
<p>为了避免歧义，还是显示使用index和type比较保险</p>
<p>⑤循环依赖问题</p>
<p>由于Spring容器对候造函数配置的Bean进行实例化的前提是，Bean构造函数入参引用的对象必须准备就绪。</p>
<p>因此若两个Bean都通过构造函数入参引用对方，则会产生类似死锁的问题。</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428164522.png" /></p>
<p>解决的办法是将注入方式改为属性注入即可。</p>
<p><strong>工厂方法注入</strong></p>
<p>非静态工厂方法</p>
<p>需要实例化工厂类才能调用，工厂类方法一般以接口或抽象类变量的形式返回目标实例。</p>
<p>CarFactory工厂仅负责创建Car类型的对象</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428190934.png" /></p>
<p>静态工厂方法：</p>
<p>无需创建工厂实例类，对其中的方法声明为static。</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428191246.png" /></p>
<p><strong>注入参数：</strong></p>
<p>字面值</p>
<p>指可用字符串表示的值，通过<value>元素标签注入。基本数据类型及其封装类、String类型都可以通过该方法注入。</p>
<p>Spirng内部的编辑器可以将其转换为内部变量的相应类型。</p>
<p>示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.attr.Car&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">				&lt;![CDATA[红旗&amp;CA72]]&gt;</span><br><span class="line">*<span class="comment">&lt;!--brand的属性值包含了一个XML的特殊符号</span></span><br><span class="line"><span class="comment">特殊标签&lt;![CDATA[]]的作用是让XML解析器让标签中的字符串</span></span><br><span class="line"><span class="comment">当作普通的文本对待--&gt;</span>*</span><br><span class="line">			<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxSpeed&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2000.00&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>XML中共有五个特殊字符，分别是<strong>&amp;</strong>、<strong>&lt;</strong>、<strong>&gt;</strong>、<strong>“</strong>、<strong>‘</strong></p>
<p>若注入值包括这些特殊字符，有两种方法</p>
<p>①采用&lt;[CDATA[]]&gt;特殊标签</p>
<p>②使用XML转义序列</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428193204.png" /></p>
<p>注：Spirng不会忽略元素标签内部字符串的前后空格，会将其一起赋给对应属性</p>
<p>引用其他Bean</p>
<p><ref>元素通过三个属性引用容器中的其他Bean</p>
<p>bean：通过该属性可以引用<strong>同一容器或父容器</strong>的Bean</p>
<p>local：引用<strong>同一配置</strong>文件中定义的Bean</p>
<p>parent：引用<strong>父容器</strong>的Bean</p>
<p>示例：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428200634.png" /></p>
<p>bean2中的boss引用了父容器中的car</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428201518.png" /></p>
<p>null值</p>
<p>使用<null/> 元素标签而不是<value><value></p>
<p>内部Bean</p>
<p>类似于java的匿名内部类</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428202245.png" /></p>
<p>级联属性</p>
<p>需要类提供一个级别的实例化，采用圆点（.）的方法定义级别</p>
<p>示例：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428203131.png" /></p>
<p>集合类型属性</p>
<p><strong>List</strong></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428205325.png" /></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428205344.png" /></p>
<p>S<strong>et</strong></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428205429.png" /></p>
<p><strong>Map</strong></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428205635.png" /></p>
<p>如果某一Map元素的键和值都是对象，则采用以下配置方式：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428205933.png" /></p>
<p>Properties</p>
<p>Map类型的特例，键和值的类型只能是字符串</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428210114.png" /></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：没有<span class="tag">&lt;<span class="name">value</span>&gt;</span>子元素标签</span><br></pre></td></tr></table></figure>
<p>强类型集合</p>
<p>强类型的Map类型，键为String，值为Integer</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428210327.png" /></p>
<p>配置与非强类型集合相同</p>
<p>集合合并</p>
<p>允许子<bean>继承父<bean>的同名属性集合元素，并将两个<bean>的属性值合并起来作为最终Bean的属性值</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428210615.png" /></p>
<p>通过util命名空间配置集合类型的Bean</p>
<p>希望配置一个集合类型的Bean，而不是属性</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210428211500.png" /></p>
<p>简化配置</p>
<p>字面值属性</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210506190256.png" /></p>
<p>注意：简化后无法使用&lt;[CDATA[]]&gt;处理XML特殊字符，只能用XML转义序列对特殊字符进行转换</p>
<p>引用对象属性</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210506190533.png" /></p>
<p>注意：只有<ref bean="xxx">有简化形式，即<ref>，而local和parent没有对应的简化形式</p>
<p>采用p命名空间</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210506191920.png" /></p>
<p>字面值格式：</p>
<p>p：<属性名>&quot;xxx&quot;</p>
<p>引用对象的格式</p>
<p>p：<属性名>-ref=&quot;xxx&quot;</p>
<p>由于p命名空间的属性名是可变的，因此没有对应的Schema文件，因此无须在xsi:schemaLocation处指定文件</p>
<p>自动装配</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210506192927.png" /></p>
<p>使用注解的配置方式默认采用byType自动装配策略</p>
<p>而XML很少启用自动装配功能</p>
<p><strong>方法注入</strong></p>
<p>向singleton的Boss中注入prototype的Car，并且希望每次调用boss Bean的getCar()方法时都能返回一个新的car Bean。由于singleton的Bean注入关联Bean的动作仅有一次，因此返回的对象还是最开始注入的那个car Bean</p>
<p>其中一个方法时让Boss实现BeanFactoryAware接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Car <span class="title">getCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//通过getBean()返回prototype的Bean</span></span><br><span class="line">	<span class="keyword">return</span> (Car)factory.getBean(<span class="string">&quot;car&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Bean的作用域：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ee603c566d73" class="uri">https://www.jianshu.com/p/ee603c566d73</a></p>
<p>下文也有讲到</p>
<p><em>lookup方法注入</em></p>
<p>CGLib可以在运行期动态操作Class字节码，为Bean动态创建子类或实现类，详见第七章(插入link)</p>
<p>声明MagicBoss接口，并声明一个getCar()的接口方法。</p>
<p>通过配置为接口完成动态实现</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210506200013.png" /></p>
<p>该方法一般用于通过一个singleton Bean获取一个prototype Bean</p>
<p><em>方法替换</em></p>
<p>用某个Bean的方法去替换另一个Bean的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.smart.injectfun;</span><br><span class="line"><span class="comment">//Boss1返回宝马</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss1</span> <span class="keyword">implements</span> <span class="title">MagicBoss</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Car <span class="title">getCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Car car = <span class="keyword">new</span> Car();</span><br><span class="line">		car.setBrand(<span class="string">&quot;宝马Z4&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> car;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.smart.injectfun;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.MethodReplacer;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss2</span> <span class="keyword">implements</span> <span class="title">MethodReplacer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">reimplement</span><span class="params">(Object arg0, Method arg1, Object[] arg2)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		Car car = <span class="keyword">new</span> Car();</span><br><span class="line">		car.setBrand(<span class="string">&quot;美人豹&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> car;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用于替换的Bean需要实现MethodReplacer接口</p>
<p>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;&lt;http://www.springframework.org/schema/beans&gt;&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;&lt;http://www.w3.org/2001/XMLSchema-instance&gt;&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;&lt;http://www.springframework.org/schema/p&gt;&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;&lt;http://www.springframework.org/schema/beans&gt; </span></span></span><br><span class="line"><span class="tag"><span class="string">         &lt;http://www.springframework.org/schema/beans/spring-beans-4.0.xsd&gt;&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.injectfun.Car&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:brand</span>=<span class="string">&quot;红旗CA72&quot;</span> <span class="attr">p:price</span>=<span class="string">&quot;2000&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;magicBoss&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.injectfun.MagicBoss&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lookup-method</span> <span class="attr">name</span>=<span class="string">&quot;getCar&quot;</span> <span class="attr">bean</span>=<span class="string">&quot;car&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;boss2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.injectfun.Boss2&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;boss1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.injectfun.Boss1&quot;</span>&gt;</span></span><br><span class="line">     ***<span class="tag">&lt;<span class="name">replaced-method</span> <span class="attr">name</span>=<span class="string">&quot;getCar&quot;</span> <span class="attr">replacer</span>=<span class="string">&quot;boss2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">replaced-method</span>&gt;</span>***</span><br><span class="line">  <span class="comment">&lt;!--使用Boss2的MethodReplacer接口方法替换getcar()方法--&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Bean之间的关系</strong></p>
<p>继承</p>
<p>父子<bean></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父子&lt;bean&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;abstractCar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.Car&quot;</span></span></span><br><span class="line"><span class="tag">	      <span class="attr">p:brand</span>=<span class="string">&quot;红旗CA72&quot;</span> <span class="attr">p:price</span>=<span class="string">&quot;2000.00&quot;</span> <span class="attr">p:color</span>=<span class="string">&quot;黑色&quot;</span></span></span><br><span class="line"><span class="tag">	      <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><span class="comment">&lt;!--true代表不实例化为一个Bean--&gt;</span></span><br><span class="line">	      </span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car3&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;abstractCar&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span> <span class="attr">value</span>=<span class="string">&quot;红色&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car4&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;abstractCar&quot;</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span> <span class="attr">value</span>=<span class="string">&quot;白色&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果子bean提供了父bean已有的配置信息，那么将会覆盖父bean中的配置信息--&gt;</span></span><br></pre></td></tr></table></figure>
<p>依赖</p>
<p>一般使用ref元素标签建立对其他Bean的依赖关系</p>
<p>而对于层层依赖的关系，则可以使用depends-on属性显示指定Bean前置依赖的Bean。</p>
<p>例如CacheManager依赖于SystemSettings，而SystemSettings的值由SysInit负责初始化。CacheManager不直接依赖SysInit，但需要SysInit加载完成并设置系统参数设置后再启动，因此要保证SI在CM之前初始化。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;bean&gt;的信赖 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.CacheManager&quot;</span> ***<span class="attr">depends-on</span>=<span class="string">&quot;sysInit&quot;</span>*** /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sysInit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.SysInit&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>引用</p>
<p>一个bean要引用另一个bean的id属性值</p>
<p>若设置为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.Car&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;boss&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.Boss&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">p:</span> <span class="attr">carId</span> = <span class="string">&quot;car&quot;</span> <span class="attr">scope</span> = <span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>则只是以字面值的形式进行设置，但两者没有建立引用关系，而Spring容器不会在启动时对属性配置值进行特殊检查，因此这样设置会等到具体调用时才会发现错误。</p>
<p>因此通过<idref>标签，可以提前发现错误</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;bean&gt;引用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.Car&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;boss&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.tagdepend.Boss&quot;</span> &gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;carId&quot;</span>  &gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">idref</span> <span class="attr">bean</span> = <span class="string">&quot;car&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>整合多个配置文件</strong></p>
<p>若有多个XML配置文件，可以用String数组来指定，或者使用<import>将多个配置文件引入到一个文件中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;&lt;http://www.springframework.org/schema/beans&gt;&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;&lt;http://www.w3.org/2001/XMLSchema-instance&gt;&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;&lt;http://www.springframework.org/schema/p&gt;&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;&lt;http://www.springframework.org/schema/beans&gt; </span></span></span><br><span class="line"><span class="tag"><span class="string">	 &lt;http://www.springframework.org/schema/beans/spring-beans-4.0.xsd&gt;&quot;</span>&gt;</span></span><br><span class="line">    **<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:com/smart/impt/beans1.xml&quot;</span>/&gt;</span>**</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;boss1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.fb.Boss&quot;</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">p:name</span>=<span class="string">&quot;John&quot;</span> <span class="attr">p:car-ref</span>=<span class="string">&quot;car1&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;boss2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.fb.Boss&quot;</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">p:name</span>=<span class="string">&quot;John&quot;</span> <span class="attr">p:car-ref</span>=<span class="string">&quot;car2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：</p>
<p>若一个配置文件a.xml定义的bean引用了b.xml中的bean，则不一定要使用<import>，只需要两个配置文件都在配置文件列表中即可。</p>
<p>若采用import，则容器启动时仅需要加载a.xml即可，否则需要同时加载a和b.xml，以便在内存中合并。</p>
<p><strong>Bean作用域</strong></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507182128.png" /></p>
<p>singleton作用域</p>
<p>singleton的Bean在同一Spring IoC中只有一个实例</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507182818.png" /></p>
<p>ApplicationContext容器在启动时，自动实例化所有的singleton的Bean并缓存于容器中。</p>
<p>这样有两个好处：</p>
<p>①可以及早发现一些潜在的配置问题</p>
<p>②Bean以缓存的方式保存，再需要用到该Bean时就无需再实例化了。</p>
<p>若不希望提前实例化，则可以通过lazy-init控制</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507183302.png" /></p>
<p>prototype作用域</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507183639.png" /></p>
<p>boss的三个bean引用的都是一个新的实例，并且每次通过容器的getBean()方法返回的都是一个新的实例</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507183721.png" /></p>
<p>与Web应用相关的作用域</p>
<p>使用WebApplicationContext可以使用另外三种作用域，但需要进行额外配置</p>
<p>利用HTTP请求监听器进行配置</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507184039.png" /></p>
<p>ContextLoaderListener和RequestContextListener区别：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507184513.png" /></p>
<p>ServletContextListener只负责监听Web容器启动和关闭的事件，而另外一个监听器监听HTTP请求事件，Web服务器接收的每一次请求都会通知该监听器。</p>
<p>Spring容器启动和关闭操作由Web容器的启动和关闭事件触发(Context...)，如果Spring容器中的Bean需要另外三种作用域的支持，则Spring容器本身必须获得Web容器的HTTP请求事件(Request...)，用该事件来“驱动”Bean作用域的控制逻辑</p>
<p>request作用域</p>
<p>该作用域的Bean对于一个HTTP请求和生命周期</p>
<p>每次HTTP请求调用Bean的时候，容器就会创建一个新的Bean，请求处理完毕后，就会销毁这个Bean</p>
<p>session作用域</p>
<p>Bean的作用域横跨整个HTTP Session，Session中的所有HTTP请求共享一个Bean，当HTTP Session结束后才销毁实例</p>
<p>globalSession作用域</p>
<p>类似于session作用域，但仅在Portlet的Web应用中使用，如果不在Protlet Web应用中，则等价于session作用域</p>
<p>作用域依赖问题</p>
<p>非Web相关作用域引用Web相关作用域的Bean</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507190527.png" /></p>
<p>为了使boss能从适当作用域中获取car的引用，需要使用AOP为car配置一个代理类</p>
<p>当boss Bean在Web环境下调用car Bean时，Spring AOP将期用动态代理智能地判断boss 在哪个HTTP请求线程中，并从对应的HTTP请求线程域中获取对应的car</p>
<p>由于car Bean的作用域为request，所有每个调用到car的HTTP请求都会创建一个car Bean，通过动态代理，使boss引用到对应HTTP请求的car</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507191429.png" /></p>
<p>在配置文件中添加了<a href="aop:scoped-proxy/" class="uri">aop:scoped-proxy/</a>后 ，注入boss的使car Bean的动态代理对象，不是原来的car Bean。</p>
<p><strong>FactoryBean</strong></p>
<p>某些情况下，通过反射机制利用bean的class属性指定实现类实例化Bean的过程会比较复杂，这时候可以使用工厂类接口org.springframework.beans.factory.FactoryBean</p>
<p>该接口定义了三个接口方法：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507192052.png" /></p>
<p>当配置文件中bean的class属性配置的实现类使FactoryBean时，通过getBean()方法返回的不是FactoryBean本身，而是FactoryBean#getObject()方法所返回的对象。</p>
<p>编写一个FactoryBean实现类，通过逗号分隔的方式一次性为Car的所有属性指定配置值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String carInfo;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> carInfo;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//接收逗号分隔的属性设置信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCarInfo</span><span class="params">(String carInfo)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.carInfo = carInfo;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//实例化car Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Car <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Car car = <span class="keyword">new</span> Car();</span><br><span class="line">		String[] infos = carInfo.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">		car.setBrand(infos[<span class="number">0</span>]);</span><br><span class="line">		car.setMaxSpeed(Integer.parseInt(infos[<span class="number">1</span>]));</span><br><span class="line">		car.setPrice(Double.parseDouble(infos[<span class="number">2</span>]));</span><br><span class="line">		<span class="keyword">return</span> car;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//返回car的类型</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Class&lt;Car&gt; <span class="title">getObjectType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Car.class;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.fb.CarFactoryBean&quot;</span></span></span><br><span class="line"><span class="tag">	      <span class="attr">p:carInfo</span>=<span class="string">&quot;红旗CA72,200,20000.00&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>基于注解的配置</strong></p>
<p>使用注解定义Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="comment">//通过Component定义一个DAO的Bean</span></span><br><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>等效于</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210507194502.png" /></p>
<p>除了@Component外，Spring还提供了3个注解：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210508190707.png" /></p>
<p>扫描注解定义的Bean</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210508195338.png" /></p>
<p>②处通过base-package属性指定了一个需要扫描的基类包，Spring会扫描该基类包的所有类，并从类的注解信息中获取Bean的定义信息。</p>
<p>可以使用resource-pattern属性过滤出特定的类</p>
<p>&lt;context: compontent-scan base-package=&quot;com.smart&quot; resource-pattern=&quot;anno/*.class&quot;/&gt;</p>
<p>默认情况下resource-pattern属性的值为&quot;**/*.class​&quot;，即基类包中的所有类</p>
<p>若仅需要过滤基类包中实现了某个接口的类或标注了某个特定注解的类，resource-pattern无法实现，需要使用&lt;context:component-scan&gt;​的过滤子元素</p>
<p>例如：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210512145645.png"/></p>
<p>include表示要包含的目标类，而exclude表示要排除的目标类，一个子过滤属性可以有若干个Include和exclude，过滤表达式如下图</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210508200206.png" /></p>
<p>除了custom类型外，aspectj的过滤表达能力最强，可实现其他类型所表达的过滤规则</p>
<p>在&lt;context:component-scan​/&gt;​中还要一个属性：use-default-filters，默认值为true，表示默认会对标注@Component、<span class="citation" data-cites="Controller">@Controller</span>、<span class="citation" data-cites="Service和">@Service和</span><span class="citation" data-cites="Reposity">@Reposity</span>。</p>
<p>&lt;context:component-scan/​&gt;会根据&lt;exclude-filter/&gt;列出需要排除的黑名单，再根据&lt;include-filter&gt;列出需要包含的白名单，由于默认值为true，因此会对所有Bean进行扫描。</p>
<p>若改为false：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210512153137.png"/></p>
<p>则仅扫描@Controller的bean。</p>
<h3 id="自动装配bean"><strong>自动装配Bean</strong></h3>
<h4 id="autowired进行自动注入">Autowired进行自动注入</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span> <span class="comment">//定义一个Service的Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogonService</span> <span class="keyword">implements</span> <span class="title">BeanNameAware</span> </span>&#123;</span><br><span class="line"><span class="comment">//分别注入LogDao及UserDao的Bean</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LogDao logDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>
<p><span class="citation" data-cites="Autowired默认按类型">@Autowired默认按类型</span>(byType)匹配的方式在容器中查找匹配的Bean，当且仅当只有一个匹配的Bean时，Spring将其注入@Autowired标注的变量中。</p>
<h4 id="使用autowired的required属性">使用@Autowired的required属性</h4>
<p>如果容器中没有一个和标注变量类型匹配的Bean，那么Spring容器启动的时候将报错(NoSuchBeanDefinitionException异常)，如果希望Spring即使找不到匹配的Bean完成注入也不要抛出异常，则可以使用@Autowired(required=false)进行标注。默认值为true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required=false)</span></span><br><span class="line"><span class="keyword">private</span> LogDao logDao;</span><br></pre></td></tr></table></figure>
<h4 id="使用qualifier指定注入bean的名称">使用@Qualifier指定注入Bean的名称</h4>
<p>如果容器内不止一个匹配的Bean，则通过@Qualifer注解限定Bean的名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;userDao&quot;)</span><span class="comment">//注入名为userDao的Bean</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>
<h4 id="对类方法进行标注">对类方法进行标注</h4>
<p><span class="citation" data-cites="Autowired可以对类成员变量及方法的入参进行标注">@Autowired可以对类成员变量及方法的入参进行标注</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//自动将userDao的Bean传给方法入参</span></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="meta">@Qualifier(&quot;userDao&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;auto inject&quot;</span>);</span><br><span class="line">     <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//自动将LogDao传给方法入参</span></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogDao</span><span class="params">(LogDao logDao)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.logDao = logDao;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>如果一个方法拥有多个入参，默认情况下Spring将自动选择匹配入参类型的Bean进行注入。可以使用@Qualifier以指定注入Bean的名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="meta">@Qualifier(&quot;userDao&quot;)</span>UserDao userDao,LogDao logDao)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;multi param inject&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    <span class="keyword">this</span>.logDao =logDao;</span><br></pre></td></tr></table></figure>
<p>一般大部分Bean为singleton的，所以一般无需通过注解的value属性为Bean指定名称，也无需使用@Qualifier注解按名称进行注入</p>
<p>实际项目中建议在方法上标注@Autowired注解。</p>
<h4 id="对集合类进行标注">对集合类进行标注</h4>
<p>如果对类中集合类的变量或方法入参进行@Autowired标注，那么Spring会将容器中类型匹配的所有Bean自动注入进来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将容器中所有类型为Plugin的Bean注入该变量中</span></span><br><span class="line">   <span class="meta">@Autowired(required=false)</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;Plugin&gt; plugins;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将Plugin类型的Bean注入到Map中</span></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> Map&lt;String,Plugin&gt; pluginMaps;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;Plugin&gt; <span class="title">getPlugins</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> plugins;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>plugin有两个实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pluginone</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(value = 1)</span><span class="comment">//指定此插件的加载顺序，值越小，优先级越高</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnePlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//plugintwo</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(value = 2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoPlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对延迟依赖注入的支持">对延迟依赖注入的支持</h4>
<p>在Bean上标注@Lazy和<span class="citation" data-cites="Autowired注解的属性">@Autowired注解的属性</span>，延迟到调用此属性时才注入属性值</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210512163230.png"/></p>
<p>注意：<span class="citation" data-cites="Lazy注解后面要跟上属性及目标Bean上">@Lazy注解后面要跟上属性及目标Bean上</span></p>
<h3 id="bean作用范围及生命过程方法">Bean作用范围及生命过程方法</h3>
<p>使用注解配置的Bean与XML配置的Bean的默认作用范围都为singleton。</p>
<p>使用@Scope注解可以显示指定Bean的作用范围</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定Bean的作用范围为prototype</span></span><br><span class="line"><span class="meta">@Scope(BeanDefinition.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> maxSpeed;</span><br><span class="line">   <span class="keyword">public</span> String brand;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span>  String  HONG_QI = <span class="string">&quot;红旗&quot;</span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getBrand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> brand;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBrand</span><span class="params">(String brand)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.brand = brand;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaxSpeed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> maxSpeed;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxSpeed</span><span class="params">(<span class="keyword">int</span> maxSpeed)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.maxSpeed = maxSpeed;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> price;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.price = price;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;brand:&quot;</span>+brand+<span class="string">&quot;/maxSpeed:&quot;</span>+maxSpeed+<span class="string">&quot;/price:&quot;</span>+price;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用@PostConstruct和<span class="citation" data-cites="PreDestroy注解可以指定Bean的初始化及容器销毁前执行的方法">@PreDestroy注解可以指定Bean的初始化及容器销毁前执行的方法</span>。在一个Bean中可以定义多个两种注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> Car car;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Boss</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;construct...&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setCar</span><span class="params">(Car car)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;execute in setCar&quot;</span>);</span><br><span class="line">      <span class="keyword">this</span>.car = car;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setCar</span><span class="params">(Car car)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;execute in setCar&quot;</span>);</span><br><span class="line">      <span class="keyword">this</span>.car = car;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PostConstruct</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init1</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;execute in init1&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PostConstruct</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init2</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;execute in init1&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PreDestroy</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">destory1</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;execute in destory1&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PreDestroy</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">destory2</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;execute in destory2&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行测试：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210512194247.png"/></p>
<p>结果：</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210512194313.png"/></p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210512194325.png"/></p>
<p>说明Spring先调用Boss的构造函数实例化Bean，再执行@Autowired进行自动注入，然后分别执行标注了@PostConstruct的方法，再容器关闭时，执行标注了@PreDestroy的方法</p>
<h2 id="基于java类的配置">基于Java类的配置</h2>
<h3 id="javaconfig">JavaConfig</h3>
<p>普通的POJO标注@Configuration注解，可以为Spring容器提供Bean定义的信息，每一个@Bean的类方法相当于提供一个Bean的定义信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将一个POJO标注为定义Bean的配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConf</span> </span>&#123;</span><br><span class="line">   <span class="comment">//定义两个Bean，并提供实例化逻辑</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserDao();   </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LogDao <span class="title">logDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LogDao();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//定义logonService的Bean </span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LogonService <span class="title">logonService</span><span class="params">()</span></span>&#123;</span><br><span class="line">      LogonService logonService = <span class="keyword">new</span> LogonService();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//将前面的两个Bean注入</span></span><br><span class="line">      logonService.setLogDao(logDao());</span><br><span class="line">      logonService.setUserDao(userDao());</span><br><span class="line">      <span class="keyword">return</span> logonService;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上配置等效于</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.anno.UserDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.anno.LogDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logonService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.smart.conf.LogonService&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:logDao-ref</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">p:userDao-ref</span>=<span class="string">&quot;logDao&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<hr />
<p>如果需要引用不同配置类中定义的Bean，则将所需引用的Bean所在的配置类作为Bean注入到调用配置类中</p>
<p>由于@Configuration注解类本身标注了<span class="citation" data-cites="Component">@Component</span>，因此它们可以像普通的Bean注入其他的Bean中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceConfig</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//自动注入DaoConfig</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> DaoConfig daoConfig;</span><br><span class="line">    </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LogonService <span class="title">logonService</span><span class="params">()</span></span>&#123;</span><br><span class="line">      LogonService logonService = <span class="keyword">new</span> LogonService();</span><br><span class="line">      System.out.println(daoConfig.logDao() == daoConfig.logDao());</span><br><span class="line">      <span class="comment">//调用Bean的相关方法</span></span><br><span class="line">      logonService.setLogDao(daoConfig.logDao());</span><br><span class="line">      logonService.setUserDao(daoConfig.userDao());</span><br><span class="line">      <span class="keyword">return</span> logonService;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用logDao和userDao方法的时候，Spring会对配置类所有标注@Bean的方法进行AOP增强，将对Bean生命周期管理的逻辑植入进来，因此调用方法的时候将从容器中返回相应Bean的单例。在@Bean处，还可以标注@Scope注解以控制Bean的作用范围。</p>
<p>注意：容器会自动对@Configuration的类进行改造，以植入Spring容器对Bean的管理逻辑，因此需要保证aop类包和CGLIB类包加载到类路径下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean(name=&quot;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserDao();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LogDao <span class="title">logDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LogDao();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="启动容器">启动容器</h3>
<h4 id="使用configuration启动">使用@Configuration启动</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaConfigTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line"><span class="comment">//1.通过构造函数加载配置类		</span></span><br><span class="line">         ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConf.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.通过编码方式注册配置类，加载多个配置类（或者将多个配置类组装到一个配置类中，这样仅需注册这个组装好的配置类就可以启动容器）</span></span><br><span class="line">		 AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">		 ctx.register(DaoConfig.class);</span><br><span class="line">		 ctx.register(ServiceConfig.class);</span><br><span class="line">		 ctx.refresh();</span><br><span class="line"><span class="comment">//组装(在ServiceConfig.class文件中)：</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(DaoConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> DaoConfig daoConfig;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> LogonService <span class="title">logonService</span><span class="params">()</span></span>&#123;</span><br><span class="line">		LogonService logonService = <span class="keyword">new</span> LogonService();</span><br><span class="line">		System.out.println(daoConfig.logDao() == daoConfig.logDao());</span><br><span class="line">		logonService.setLogDao(daoConfig.logDao());</span><br><span class="line">		logonService.setUserDao(daoConfig.userDao());</span><br><span class="line">		<span class="keyword">return</span> logonService;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这样就只需要注册ServiceConfig即可</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="通过xml引用configuration">通过XML引用@Configuration</h4>
<p>希望使用XML启动容器，需要在XML中通过&lt; context:component-scan &gt;扫描到相应的配置类即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过上下文扫描加载到AppConf的配置类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.smart.conf&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">resource-pattern</span>=<span class="string">&quot;AppConf.class&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="通过configuration配置类引用xml">通过@Configuration配置类引用XML</h4>
<p>通过@ImportResource引入XML配置文件，通过@Autowired引用XML配置文件中定义的Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ImportResource;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过@ImportResource引入XML文件</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:com/smart/conf/beans3.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogonAppConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//自动注入XML文件中定义的Bean</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LogonService <span class="title">logonService</span><span class="params">(UserDao userDao,LogDao logDao)</span></span>&#123;</span><br><span class="line">      LogonService logonService = <span class="keyword">new</span> LogonService();</span><br><span class="line">      logonService.setUserDao(userDao);</span><br><span class="line">      logonService.setLogDao(logDao);</span><br><span class="line">      <span class="keyword">return</span> logonService;      </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只要不同形式的Bean定义信息能加载到Spring容器中，即可完成Bean之间的装配，不一定要引入XML文件</p>
<h3 id="基于groovy-dsl的配置">基于Groovy DSL的配置</h3>
<p>类似于XML，只是配置信息由Groovy脚本表达</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.smart.groovy.LogDao</span><br><span class="line"><span class="keyword">import</span> com.smart.groovy.DbUserDao</span><br><span class="line"><span class="keyword">import</span> com.smart.groovy.LogonService</span><br><span class="line"><span class="keyword">import</span> com.smart.groovy.XmlUserDao</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource</span><br><span class="line"></span><br><span class="line">beans &#123;</span><br><span class="line">    <span class="comment">//声明context命名空间</span></span><br><span class="line">    xmlns <span class="attr">context:</span> <span class="string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="comment">//导入命名空间</span></span><br><span class="line">	<span class="comment">//与注解混合使用，定义Bean扫描包路径</span></span><br><span class="line">    context.<span class="string">&#x27;component-scan&#x27;</span>(<span class="string">&#x27;base-package&#x27;</span>: <span class="string">&quot;com.smart.groovy&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">//排除不需要扫描的包路径</span></span><br><span class="line">        <span class="string">&#x27;exclude-filter&#x27;</span>(<span class="string">&#x27;type&#x27;</span>: <span class="string">&quot;aspectj&quot;</span>, <span class="string">&#x27;expression&#x27;</span>: <span class="string">&quot;com.smart.xml.*&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取app-conf.properties配置文件</span></span><br><span class="line">    <span class="keyword">def</span> stream;</span><br><span class="line">    <span class="keyword">def</span> config = <span class="keyword">new</span> Properties();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        stream = <span class="keyword">new</span> ClassPathResource(<span class="string">&#x27;conf/app-conf.properties&#x27;</span>).inputStream</span><br><span class="line">        config.load(stream);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(stream!=<span class="literal">null</span>)</span><br><span class="line">        stream.close()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//配置无参构造函数Bean</span></span><br><span class="line">    logDao(LogDao)&#123;</span><br><span class="line">        bean-&gt;</span><br><span class="line">            bean.scope = <span class="string">&quot;prototype&quot;</span>   <span class="comment">//配置作用域</span></span><br><span class="line">            bean.initMethod=<span class="string">&quot;init&quot;</span>     <span class="comment">//配置初始化方法</span></span><br><span class="line">            bean.destroyMethod=<span class="string">&quot;destory&quot;</span>  <span class="comment">//配置销毁方法</span></span><br><span class="line">            bean.lazyInit =<span class="literal">true</span>			<span class="comment">//配置懒加载</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据条件注入Bean</span></span><br><span class="line">    <span class="keyword">if</span>( config.get(<span class="string">&quot;dataProvider&quot;</span>) == <span class="string">&quot;db&quot;</span>)&#123;</span><br><span class="line">        userDao(DbUserDao)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        userDao(XmlUserDao)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置有参构造函数注入Bean，参数是userDao</span></span><br><span class="line">    logonService(LogonService,userDao)&#123;</span><br><span class="line">        logDao = ref(<span class="string">&quot;logDao&quot;</span>)	<span class="comment">//配置属性注入，引用Groovy定义Bean</span></span><br><span class="line">        mailService = ref(<span class="string">&quot;mailService&quot;</span>) <span class="comment">//配置属性注入，引用注解定义</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="启动容器-1">启动容器</h4>
<p>使用GenericGroovyApplicationContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.GenericGroovyApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.testng.annotations.Test;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.testng.Assert.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.testng.Assert.assertNotNull;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.testng.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogonServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">getBean</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//加载指定Groovy Bean配置文件来启动容器</span></span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> GenericGroovyApplicationContext(<span class="string">&quot;classpath:com/smart/groovy/spring-context.groovy&quot;</span>);</span><br><span class="line">        LogDao logDao = ctx.getBean(LogDao.class);</span><br><span class="line">        <span class="comment">//加载Groovy定义的Bean</span></span><br><span class="line">        LogonService logonService = ctx.getBean(LogonService.class);</span><br><span class="line">        assertNotNull(logonService);</span><br><span class="line">        <span class="comment">//加载注解定义的Bean</span></span><br><span class="line">        MailService mailService = ctx.getBean(MailService.class);</span><br><span class="line">        assertNotNull(mailService);</span><br><span class="line">        <span class="comment">//判断注入是否是DbUserDao</span></span><br><span class="line">        UserDao userDao = ctx.getBean(UserDao.class);</span><br><span class="line">        assertTrue(userDao <span class="keyword">instanceof</span> DbUserDao);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="通过编码方式动态加载bean">通过编码方式动态加载Bean</h3>
<h4 id="通过defaultlistablebeanfactory">通过DefaultListableBeanFactory</h4>
<p>DefaultListableBeanFactory实现了ConfigurableListableBeanFactory接口，提供了可扩展配置、循环枚举的功能，通过此类实现Bean动态注入</p>
<p>为了保证动态注入的Bean能被AOP增强，需要实现Bean工厂后置处理器接口BeanFactoryPostProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.DefaultListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceFactoryBean</span>  <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span>   </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory bf)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//①将ConfigurableListableBeanFactory转化为DefaultListableBeanFactory</span></span><br><span class="line">        DefaultListableBeanFactory beanFactory = (DefaultListableBeanFactory) bf;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//②通过BeanDefinitionBuilder创建Bean定义</span></span><br><span class="line">        BeanDefinitionBuilder beanDefinitionBuilder = BeanDefinitionBuilder.genericBeanDefinition(UserService.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//③设置属性userDao,此属性引用已经定义的bean:userDao</span></span><br><span class="line">        beanDefinitionBuilder.addPropertyReference(<span class="string">&quot;userDao&quot;</span>,<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//④注册Bean定义</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;userService1&quot;</span>, beanDefinitionBuilder.getRawBeanDefinition());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//⑤直接注册一个Bean实例</span></span><br><span class="line">        beanFactory.registerSingleton(<span class="string">&quot;userService2&quot;</span>,<span class="keyword">new</span> UserService());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="扩展自定义标签">扩展自定义标签</h4>
<p>步骤：</p>
<p>（1）采用XSD描述自定义标签的元素属性</p>
<p>（2）编写Bean定义的解析器</p>
<p>（3）注册自定义标签解析器</p>
<p>（4）绑定命名空间解析器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.smart.com/schema/service&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:beans</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line">            &lt;!--指定自定义标签的命名空间--&gt;</span><br><span class="line">            targetNamespace=&quot;http://www.smart.com/schema/service&quot;</span><br><span class="line">            elementFormDefault=&quot;qualified&quot;</span><br><span class="line">            attributeFormDefault=&quot;unqualified&quot;&gt;</span><br><span class="line">    <span class="comment">&lt;!--导入Spring本身的beans的命名空间--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义一个user-service标签--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">&quot;user-service&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:complexContent</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--定义了user-service标签的扩展属性&quot;dao&quot;，类似继承方式--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:extension</span> <span class="attr">base</span>=<span class="string">&quot;beans:identifiedType&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">&quot;dao&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xsd:string&quot;</span> <span class="attr">use</span>=<span class="string">&quot;required&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">xsd:extension</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsd:complexContent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接着编写用户服务标签解析类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.parsing.BeanComponentDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.AbstractBeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.BeanDefinitionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.ParserContext;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceDefinitionParser</span> <span class="keyword">implements</span> <span class="title">BeanDefinitionParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">parse</span><span class="params">(Element element, ParserContext parserContext)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//通过BeanDefinitionBuilder创建Bean定义</span></span><br><span class="line">        BeanDefinitionBuilder beanDefinitionBuilder = BeanDefinitionBuilder.genericBeanDefinition(UserService.class);</span><br><span class="line">        String dao = element.getAttribute(<span class="string">&quot;dao&quot;</span>);</span><br><span class="line">       <span class="comment">//获取自定义标签的属性</span></span><br><span class="line"> 	   beanDefinitionBuilder.addPropertyReference(<span class="string">&quot;userDao&quot;</span>,dao);</span><br><span class="line">        AbstractBeanDefinition beanDefinition = beanDefinitionBuilder.getBeanDefinition();</span><br><span class="line">        <span class="comment">//注册BEAN定义</span></span><br><span class="line">        parserContext.registerBeanComponent(<span class="keyword">new</span> BeanComponentDefinition( beanDefinition,<span class="string">&quot;userService&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着将解析器注册到Spring命名空间解析器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.smart.dynamic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceNamespaceHandler</span> <span class="keyword">extends</span> <span class="title">NamespaceHandlerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">&quot;user-service&quot;</span>, <span class="keyword">new</span> UserServiceDefinitionParser());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绑定自定义Bean解析器，只需要继承NamespaceHandlerSupport类，实现NamespaceHandler#init()方法，并在init()方法中注册自定义Bean解析器</p>
<p>最后需要告诉Spring如何解析自定义标签，在源码resoure目录创建META-INF文件夹，并在其中创建spring.handlers和spring.schemas两个文件，告诉Spring自定义标签的文档结构及解析它的类</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210513202132.png"/></p>
<p>在schemas中告诉Spirng描述自定义标签的文档结构文件所在位置</p>
<p>在handles文件中告诉Spring自定义命名空间所对应的解析器</p>
<p>使用自定义标签</p>
<p><img src="https://raw.githubusercontent.com/mclaren8/images/master/20210513202333.png"/></p>
<h3 id="不同配置方式比较">不同配置方式比较</h3>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">基于XML配置</th>
<th style="text-align: center;">基于注解配置</th>
<th style="text-align: center;">基于Java类配置</th>
<th>基于Groovy DSL配置</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Bean定义</td>
<td style="text-align: center;">在XML文件中<br />通过&lt;bean&gt;元素定义Bean，如<br />&lt;bean<br />class=&quot;com.smart.UserDao&quot;/&gt;</td>
<td style="text-align: center;">在 Bean实现类处通过标注@Compoent或衍型类(<span class="citation" data-cites="Repository">@Repository</span>、<span class="citation" data-cites="Service及">@Service及</span><span class="citation" data-cites="Controller">@Controller</span> ) 定义Bean</td>
<td style="text-align: center;">在标注了@Configuration的Java类中，通过在类方法上标注@Bean定义一个Bean。方法必须提供Bean的实例化逻辑</td>
<td>在 Groovy文件中通过DSL定义Bean，如:<br/>userDao (UserDao)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bean名称</td>
<td style="text-align: center;">通过<bean>的id或<br/>name属性定义，如:&lt;bean id-&quot;userDao&quot;class-&quot; com. smart.UserDao&quot;/&gt;<br/>默认名称为com.<br/>smart.UserDao#0</td>
<td style="text-align: center;">通过注解的value属性定义，如@Component(&quot;userDao&quot;)。默认名称为小写字母开头的类名(不带包名）userDao</td>
<td style="text-align: center;">通过@Bean的name属性定义，如@Bean(&quot;userDao&quot;)。默认名称为方法名</td>
<td>通过Groovy 的 DSL定义Bean的名称(Bean的类型，Bean构建函数参数)，如:<br/>logonService (LogonService,userDao)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Bean注入</td>
<td style="text-align: center;">通过<property>子元素或通过p命名空间的动态属性，如p:<br/>userDao-ref-&quot;userDao&quot;进行注入</td>
<td style="text-align: center;">通过在成员变更或方法入参处标注@Autowired,按类型匹配自动注入。还可以配合使用@Qualifier按名称匹配方式注入</td>
<td style="text-align: center;">比较灵活，可以在方法处通过@Autowired使方法入参绑定Bean，然后在方法中通过代码进行注入;还可通过调用配置类的@Bean方法进行注入</td>
<td>比较灵活，可以在方法处通过ref0方法进行注入，如ref(&quot;&quot;logDao&quot;&quot;)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bean生命过程方法</td>
<td style="text-align: center;">通过<bean>的init-method和 destory-method·属性指定Bean实现类的方法名。最多只能指定一个初始化方法和一个销毁方法</td>
<td style="text-align: center;">通过在目标方法上标注@PostConstruct和<span class="citation" data-cites="PreDestroy注解指定初始化或销毁方法">@PreDestroy注解指定初始化或销毁方法</span>，可以定义任意多个</td>
<td style="text-align: center;">通过@Bean的initMethod或destoryMethod指定一个初始化或销毁方法。<br/>对于初始化方法来说，可以直接在方法内部通过代码的方式灵活定义初始化逻辑</td>
<td>通过bean-&gt;bean.initMethod或bean.destoryMethod指定一个初始化或销毁方法</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Bean作用范围</td>
<td style="text-align: center;">通过<bean>的scope属性指定，如:<br/>&lt;bean class=&quot;com.smart.UserDao .<br/>scope-&quot; prototype&quot;/&gt;</td>
<td style="text-align: center;">通过在类定义处标注@Scope指定，如@Scope(&quot;prototype&quot;)</td>
<td style="text-align: center;">通过在 Bean方法定义处标注@Scope指定</td>
<td>通过bean-&gt; bean.scope=&quot;prototype&quot;指定</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bean延迟初始化</td>
<td style="text-align: center;">通过<bean>的lazy-init属性指定，默认为default，继承于beans&gt;的<br/>default-<br/>lazy-init设置，该值默认为false</td>
<td style="text-align: center;">通过在类定义处标注@Lazy指定，如@Lazy(true)</td>
<td style="text-align: center;">通过在 Beam方法定义处标注@Lazy指定</td>
<td>通过bean-&gt; bean. lazylnit =true指定</td>
</tr>
</tbody>
</table>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>McLaren888
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://example.com/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter5/" title="精通Spring4.x-chapter5">http://example.com/2021/05/08/精通Spring4-x-chapter5/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/spring4-x/" rel="tag"># spring4.x</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/05/08/%E7%B2%BE%E9%80%9ASpring4-x-chapter4/" rel="prev" title="精通Spring4.x-chapter4">
                  <i class="fa fa-chevron-left"></i> 精通Spring4.x-chapter4
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/05/08/Hexo-next%E4%B8%BB%E9%A2%98%E4%BB%A3%E7%A0%81%E5%9D%97%E9%AB%98%E4%BA%AE%E8%AE%BE%E7%BD%AE/" rel="next" title="Hexo-next主题代码块高亮设置">
                  Hexo-next主题代码块高亮设置 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">McLaren888</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{&quot;enable&quot;:true,&quot;tags&quot;:&quot;none&quot;,&quot;js&quot;:&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;mathjax@3.1.4&#x2F;es5&#x2F;tex-mml-chtml.js&quot;}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
